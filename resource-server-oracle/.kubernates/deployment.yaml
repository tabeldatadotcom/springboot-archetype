apiVersion: apps/v1
kind: Deployment
metadata:
  name: resource-server
  annotations:
    app.gitlab.com/app: "${CI_PROJECT_PATH_SLUG}"
    app.gitlab.com/env: "${CI_ENVIRONMENT_SLUG}"
  labels:
    app: resource-server
    env: "${CI_ENVIRONMENT_SLUG}"
    tier: backend
spec:
  replicas: 1
  template:
    metadata:
      name: resource-server
      labels:
        app: resource-server
        env: "${CI_ENVIRONMENT_SLUG}"
        tier: backend
    spec:
      containers:
        - name: resource-server
          image: "${PRIVATE_REGISTRY_PULL}/${CI_REGISTRY_NAMESPACE}/${CI_REGISTRY_IMAGE}:${CI_IMAGE_VERSION}"
          imagePullPolicy: "Always"
          envFrom:
            - configMapRef:
                name: resource-server-config
      imagePullSecrets:
        - name: nexus-regcred
      restartPolicy: Always
  selector:
    matchLabels:
      app: resource-server
      env: "${CI_ENVIRONMENT_SLUG}"
      tier: backend
